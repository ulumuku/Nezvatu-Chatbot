# -*- coding: utf-8 -*-
import random
import math
import time
import datetime


class Exiting(Exception):       #Виключення задля роботи перериваючих команд
    pass


class BackRequested(Exception):
    pass


class Stopping(Exception):
    pass

date_time = datetime.datetime.now().strftime("%Y-%m-%d_%H-%M-%S")       #час та дата для збереження діалогу
topic_history = []                                                      #історія тем
topics_dictionary = {                                                    #теми
    'фізика': ['закон збереження енергії',  #
               'закон кулона',  #
               'закон стефана-больцмана'],  #
    'математика': ['формула скалярного добутку векторів',  #
                   'формула для обчислення площі трикутника за допомогою векторного добутку',  #
                   'формула для обчислення довжини відрізка між двома точками на площині',  #
                   'площа трикутника'],  #
    'географія': ['назвіть 5 найвищих гір в світі та вкажіть їхні висоти',  #
                  'який материк найбільший за площею'],  #
    'філологія': ['яка різниця між present simple та present continuous',  #
                  'яка різниця між some та any',  #
                  'яка різниця між іменником та прикметником',  #
                  'які роди іменників існують в українській мові'],  #
    'астрономія': ['які наукові місії здійснювалися на місяць',  #
                   'які процеси відбуваються на сонці та як вони впливають на землю'],  #
    'загальні': ['заспівати колядку',
                 'зачитати вірш',
                 'розповісти анекдот'],
    'від студента': ['заспівати пісню',
                     'хто такий юрій гуляницький',
                     'цікавий факт',
                     'в чому сенс життя',
                     'що варто зауважити при створенні власного чатботу']
}
#вітання
greeting = f"""Вітаю, мене звати Незвати. Ви можете задати мені питання з наступних тем: {', '.join(topics_dictionary.keys())}."""

#вивід "типу як у чатGPT, але сіпаний, бо пайтон погано відображає з затримками менше 0.25, що занадто довго
# нажаль загубив адекватну логарифмічну формулу екпаненції :(
def smooth_console_output(text, initial_delay=0.07, decay_factor=0.98):
    for index, char in enumerate(text):
        print(char, end='', flush=True)
        delay = initial_delay * (decay_factor ** index)
        time.sleep(delay)
    print('')

#вивід та передача тексту для збереження
def bot_response(answer):
    smooth_console_output(f'[Бот]: {answer}')
    store_chat_log("", answer)

#випадкові додатки до виводу
def random_comment():
    comments = ["Цікава тема! ", "Тривіальний вибір, але добре...", "Сподіваюсь ви будете задоволені відповіддю..."]
    return random.choice(comments)

#команда допомога
def print_help():
    bot_response(f'''{get_info()}\nЩоб вийти з діалогу введіть "вихід", щоб повернутися до минулої теми введіть "назад", щоб отримати список доступних тем та команд введіть "допомога".''')

#інформація про поточну тему та доступні підтеми
def get_info():
    current_topic = get_current_topic()
    available_subtopics = get_subtopics(current_topic)
    subtopics_string = ", ".join(available_subtopics)
    if current_topic is not None:
        if len(subtopics_string) == 0:
            info = f"Обрана операція: {current_topic}.\nДоступні підтеми відсутні."
        else:
            info = f"Обрана тема: {current_topic}.\nДоступні підтеми: {subtopics_string}."
    else:
        info = f"Жодної теми не обрано. Доступні теми: {subtopics_string}."
    return info

#отримання вводу користувача
def get_user_input():
    user_input = input('[Користувач]:')
    store_chat_log(user_input, "")
    return user_input

#перевірка вводу на наявність комманд: підняття виключень у разі наявності,
# передача текстового змісту далі у разі відсутності
def check_input_for_commands():
    initial_input = get_user_input().lower()
    if initial_input == 'вихід':
        raise Exiting("Визхід з программи")
    elif initial_input == 'назад':
        raise BackRequested
    elif initial_input == 'допомога':
        print_help()
    else:
        return initial_input

#захоплення чисел для оьрахунків зі збереженням перевірки на команди,
# перевіркою на порожність та невідповідність типу данних
def get_float():
    while True:
        try:
            value_for_float = check_input_for_commands()
            if value_for_float is None:
                continue
            else:
                try:
                    value_for_float = float(value_for_float)
                    return value_for_float
                except ValueError:
                    print("Незрозумілі вхідні дані, будь ласка, введіть число або команду з загальнодоступних")
        except BackRequested:
            raise Stopping

#визначення поточної теми
def get_current_topic():
    if len(topic_history) == 0:
        return None
    return topic_history[-1]

#визначення доступних підтем за поточною темою
def get_subtopics(topic):
    if topic is None:
        subtopics = list(topics_dictionary.keys())
    else:
        subtopics = topics_dictionary.get(topic, [])
    return subtopics

#вивід відповіді за обраною підтемою обраної теми при неформульному її змісті,
#виклик обробки формульних тем при формулльному
def handle_subtopics(subtopic):
    if subtopic == 'назвіть 5 найвищих гір в світі та вкажіть їхні висоти':
        bot_response("""1.Еверест: 8,848 метрів (29,029 футів). Еверест розташований у Гімалаях, на кордоні Непалу та Китаю (Тибет).
2.Канченджанга: 8,586 метрів (28,169 футів). Канченджанга знаходиться на кордоні Непалу та Індії в Гімалаях.
3.Канченджанга: 8,516 метрів (27,940 футів). Канченджанга також розташована на кордоні Непалу та Індії в Гімалаях.
4.Лхоцзе: 8,516 метрів (27,940 футів). Лхоцзе розташована в Гімалаях, на кордоні Непалу та Китаю (Тибет).
5.Макалу: 8,485 метрів (27,838 футів). Макалу знаходиться в Гімалаях, у Непалі.)""")
    elif subtopic == 'який материк найбільший за площею':
        bot_response("""Найбільший материк за площею - це Азія. За офіційними даними, площа Азії становить близько 44,5 мільйона квадратних кілометрів (17,2 мільйона квадратних миль). Азія розташована на сході від Європи, на північ від Африки, на заході від Тихого океану і на південь від Арктики. Вона охоплює значну частину світу та має різноманітну географію, включаючи великі гори (такі як Гімалайський хребет та Тянь-Шань), пустелі (наприклад, Гобі та Сахара), річки (наприклад, Янцзи та Ганг) та простори східних степів. """)
    elif subtopic == 'яка різниця між present simple та present continuous':
        bot_response("""Present Simple використовується для розповіді про загальні факти, регулярні дії, розклад або особисті привички. Наприклад: "I go to school every day" (Я ходжу до школи щодня).
Present Continuous використовується для опису дій, які відбуваються в момент говоріння або навколишньому часі, тимчасових ситуацій або майбутніх планів у недалекому майбутньому. Наприклад: "I am studying for my exams" (Я вчуся на свої іспити) або "We are going out for dinner tomorrow" (Ми підемо на вечерю завтра). """)
    elif subtopic == 'яка різниця між some та any':
        bot_response(""""Some" використовується для позитивного контексту або пропозицій. Наприклад: "Can I have some water, please?" (Можна мені трохи води, будь ласка?).
"Any" використовується для заперечного контексту або питань. Наприклад: "I don't have any money." (У мене немає грошей) або "Did you buy any books?" (Ти купив якісь книжки?). """)
    elif subtopic == 'яка різниця між іменником та прикметником':
        bot_response("""Іменник - слово, що називає предмети або ідеї.
Прикметник - слово, що описує іменники, вказуючи на їхні властивості. """)
    elif subtopic == 'які роди іменників існують в українській мові':
        bot_response("""Українська мова має три роди іменників: чоловічий, жіночий та середній. """)
    elif subtopic == 'які наукові місії здійснювалися на місяць':
        bot_response("""Наукові місії на Місяць були проведені кількома країнами. Основні наукові місії на Місяць включають:
Програма Аполлон (Apollo) США: Між 1969 та 1972 роками програма Аполлон здійснила серію пілотованих місій на Місяць. Астронавти Аполлона 11 в 1969 році вперше ступили на поверхню Місяця.
Програма "Луноход" (Lunokhod) СРСР: У рамках цієї програми було запущено ряд безпілотних місій на Місяць. Луноходи були використані для вивчення поверхні та проведення наукових досліджень.
Місія "Чандраяан" (Chandrayaan) Індія: У 2008 та 2019 роках Індія запустила місії "Чандраяан-1" та "Чандраяан-2" відповідно. Ці місії мала на меті вивчення поверхні Місяця та пошуку води.
Програма "Янгли" (Yutu) Китай: Китай здійснив безпілотну місію "Янгли-2" в 2019 році. Це була друга китайська місія на Місяць, яка включала посадку і рух безпілотного ровера "Янгли" по поверхні Місяця.
Ці місії та інші наукові проекти сприяли поглибленню нашого розуміння Місяця та вивченню космічного простору. """)
    elif subtopic == 'які процеси відбуваються на сонці та як вони впливають на землю':
        bot_response("""На Сонці відбуваються різноманітні процеси, включаючи ядерні реакції, магнітні поля та випромінювання. Основні процеси на Сонці включають:
Ядерні реакції: В центрі Сонця відбуваються ядерні реакції, внаслідок яких водень перетворюється на гелій. Цей процес відомий як ядерний синтез і здійснюється за участю великих температур і тиску.
Сонячне випромінювання: Сонце випромінює велику кількість енергії у вигляді світла та електромагнітного випромінювання. Ця енергія, відома як сонячне випромінювання, включає видиме світло, інфрачервоне та ультрафіолетове випромінювання.
Сонячний вітер: Сонячний вітер - це потік заряджених частинок, що випромінюються Сонцем у всіх напрямках. Цей потік частинок може впливати на магнітосферу Землі та спричиняти явища, такі як сяйво та поларні сяйва.
Сонячні спалахи та корональні викиди: Сонячні спалахи - це вибухи енергії на поверхні Сонця, що випромінюються у великій кількості. Корональні викиди - це великі викиди гарячого газу з зовнішнього шару Сонця. Ці явища можуть мати вплив на розподіл електромагнітних сигналів та спричиняти сонячні бурі на Землі.
Вплив Сонця на Землю включає:
Забезпечення світла та тепла, необхідного для життя на Землі.
Вплив на клімат """)
    elif subtopic == 'заспівати колядку':
        carols = ["""Коляд, коляд, колядниця, 
                    Добра з медом паляниця,
                    А без меду не така,
                    Дайте, дядьку, п’ятака.
                    Одчиняйте скриньку,
                    Та давайте сливку,
                    Одчиняйте сундучок,
                    Та давайте п’ятачок.""",

                  """ Нова радість стала, яка не бувала,

                    Над вертепом звізда ясна світлом засіяла.
                    
                    Де Христос родився, з Діви воплотився,
                    
                    Як чоловік пеленами убого вповився.
                    
                    Пастушки з ягнятком перед тим дитятком
                    
                    На колінця припадають,
                    
                    Царя-Бога вихваляють.
                    
                    – Ой ти, Царю, Царю, небесний Владарю,
                    
                    Даруй літа щасливії цього дому господарю.
                    
                    Даруй господарю, даруй господині,
                    
                    Даруй літа щасливії нашій славній Україні.
                    
                    Даруй літа щасливії нашій славній Україні.""",

                  """Сумний Святий вечір в сорок шестім році:


                    По всій нашій Україні плач на кожнім кроці.
                    
                    
                    Сіли до вечері мати з діточками,
                    
                    
                    Замість мали вечеряти - вмилися сльозами.
                    
                    
                    Мати гірко плаче, а діти питають:
                    
                    
                    – Мамо, мамо, де наш тато, чом не вечеряють?
                    
                    
                    – Тато на Сибірі, в далекій чужині,
                    
                    
                    Споминає Святий вечір в нашій славній Україні.
                    
                    
                    Споминає Святий вечір та й усю родину,
                    
                    
                    Батька, матір, жінку й діти, й нашу неньку Україну.
                    
                    
                    Сумний Святий вечір в сорок шестім році:
                    
                    
                    По всій нашій Україні плач на кожнім кроці.""",
                  """ Бог предвічний народився,


                    Прийшов днесь із небес,
                    
                    
                    Щоб спасти люд свій весь,
                    
                    
                    І утішився.
                    
                    
                    В Вифлеємі народився,
                    
                    
                    Месія, Христос наш,
                    
                    
                    І пан наш, для всіх нас,
                    
                    
                    Нам народився.
                    
                    
                    Ознаймив це Ангел Божий
                    
                    
                    Наперед пастирям,
                    
                    
                    А потім звіздарям
                    
                    
                    І земним звірям.
                    
                    
                    Діва Сина як породила,
                    
                    
                    Звізда ста, де Христа
                    
                    
                    Невіста Пречиста
                    
                    
                    Сина зродила.
                    
                    
                    Тріє царі несуть дари
                    
                    
                    До Вифлеєм-міста,
                    
                    
                    Де Діва Пречиста
                    
                    
                    Сина повила.
                    
                    
                    Звізда їм ся об'явила,
                    
                    
                    В дорозі о Бозі,
                    
                    
                    При волі, при ослі
                    
                    
                    Їм ознаймила.
                    
                    
                    "Тріє царі, де ідете?"
                    
                    
                    "Ми ідем в Вифлеєм,
                    
                    
                    Вінчуєм спокоєм 
                    
                    
                    І повернемся".
                    
                    
                    Іншим путем повернули,
                    
                    
                    Погану, безстидну,
                    
                    
                    Безбожну Іроду
                    
                    
                    Не повідали.
                    
                    
                    Йосифові Ангел мовить:
                    
                    
                    З Дитятком і з Матков,
                    
                    
                    З бидлятком, ослятком
                    
                    
                    Хай ся хорониить.
                    
                    
                    "Слава Богу!" – заспіваймо,
                    
                    
                    Честь Сину Божому
                    
                    
                    Господеви нашому
                    
                    
                    Поклін віддаймо. """,
                  """Во Вифлеємі нині новина:


                    Пречиста Діва зродила Сина,
                    
                    
                    В яслах сповитий поміж бидляти,
                    
                    
                    Спочив на сіні Бог необнятий.
                    
                    
                    Вже Херувими славу співають,
                    
                    
                    Ангельські хори
                    
                    
                    Пана витають,
                    
                    
                    Пастир убогий несе, що може,
                    
                    
                    Щоб подарити Дитятко Боже.
                    
                    
                    А ясна зоря світу голосить:
                    
                    
                    Месія радість, щастє приносить!
                    
                    
                    До Вифлеєма спішіть всі нині,
                    
                    
                    Бога звитайте в бідній Дитині!
                    
                    
                    За світлом зірки, десь аж зі сходу
                    
                    
                    Йдуть три владики княжого роду,
                    
                    
                    Золото дари, кадило, миро
                    
                    
                    Враз з серцем чистим несуть в офіру.
                    
                    
                    Марія Мати Сина леліє,
                    
                    
                    Йосиф старенький пелени гріє,
                    
                    
                    А Цар всесвіта в зимні і болю
                    
                    
                    Благословить нас на ліпшу долю.
                    
                    
                    Ісусе милий, ми не богаті,
                    
                    
                    Золота дарів не можем дати,
                    
                    
                    Но дар ціннійший несем від мира,
                    
                    
                    Се віра серця, се любов щира.
                    
                    
                    Глянь оком щирим, о Божий Сину,
                    
                    
                    На нашу землю на Україну,
                    
                    
                    Зійшли їй з неба дар превеликий,
                    
                    
                    Щоб Тя славила во вічні віки.
                    
                    Щоб Тя славила во вічні віки."""]
        bot_response(random.choice(carols))
    elif subtopic == 'зачитати вірш':
        verses = ["""Встала весна, чорну землю
                    Сонну розбудила,
                    Уквітчала її рястом,
                    Барвінком укрила;
                    І на полі жайворонок,
                    Соловейко в гаї
                    Землю, убрану весною,
                    Вранці зустрічають…""",
                  """Сонце гріє, вітер віє
                    З поля на долину,
                    Над водою гне з вербою
                    Червону калину,
                    На калині одиноке
                    Гніздечко гойдає.
                    А де ж дівся соловейко?
                    Не питай, не знає.""",
                  """Реве та стогне Дніпр широкий,
                    Сердитий вітер завива,
                    Додолу верби гне високі,
                    Горами хвилю підійма.
                    І блідний місяць на ту пору
                    Із хмари де-де виглядав,
                    Неначе човен в синім морі,
                    То виринав, то потопав.
                    Ще треті півні не співали,
                    Ніхто нігде не гомонів,
                    Сичі в гаю перекликались,
                    Та ясен раз у раз скрипів.""",
                  """За сонцем хмаронька пливе,
                    Червоні поли розстилає
                    І сонце спатоньки зове
                    У синє море: покриває
                    Рожевою пеленою,
                    Мов мати дитину.""",
                  """За сонцем хмаронька пливе,
                    Червоні поли розстилає
                    І сонце спатоньки зове
                    У синє море: покриває
                    Рожевою пеленою,
                    Мов мати дитину."""]
        bot_response(random.choice(verses))
    elif subtopic == 'розповісти анекдот':
        anecdotes = ["""Штірліц схилився над картою СРСР. Його сильно рвало на Батьківщину.""",
                    """Штірліц вистрілив в упор. Упор впав навзнак. Взнак схопився і кинувся навтьоки. Втьок став захищатися.""",
                     """Штірліц дав підписку Борману. Борман загнувся.""",
                     """- Партизани! - в попихах крикнув Штірліц.
Наступного дня в попихах нагрянула рота карателів.""",
                     """Штірліц впав в яму і чудом вижив.
- Чудес не буває - подумав Штірліц і вмер"""]
        bot_response(random.choice(anecdotes))
    elif subtopic == 'заспівати пісню':
        bot_response("""Гримає грім, блискає блискавка в ночі,
                    А на горбі стоїть безумець і кричить:
                    «Зараз спіймаю тебе в торбу буде в ній твоє сяяння
                    Мені так хочеться щоб стала ти моя!»
                    
                    До лісу хлопець мчиться, до поля, і струмку,
                    Упіймати прагне блискавку!
                    
                    Сільський весь люд на це дивитись приходив,
                    Як по горбі безумець бігав і чудив.
                    Він видно в сварці з головою, видно ворог сам собі,
                    От дурень – треба мати таке у голові!
                    
                    До лісу хлопець мчиться, до поля, і струмку,
                    Хоче, щоб впіймалась блискавка!
                    
                    Вранці селом по дорозі
                    Повільно йшов герой нічний
                    Весь кудлатий і сивий... і усміхався
                    
                    До лісу хлопець мчався, до поля, і струмку,
                    Хотів і впіймалась блискавка!""")
    elif subtopic == 'хто такий юрій гуляницький':
        bot_response("""Юрій Гуляницький, містичний невідомий студент з першої групи першого курсу, виявився справжньою загадкою для всього університетського співтовариства. 
Його ім'я шепочуть по коридорах, але ніхто не знає, як він виглядає, де живе, і що його надихає.
Розмови про Юрія ходять навколо таємничих подій, які почалися з його приходом. 
Його виступи на семінарах і лекціях завжди приховані, але водночас пронизані глибоким розумінням і мудрістю, яка виходить далеко за рамки його навчальних здібностей.
Студенти з першої групи постійно знаходять підказки і загадки, які, здається, залишив Юрій. 
Вони допомагають їм розширити свої знання і проникнути в світ таємниць. Його записки з першого курсу наповнені символами і загадками, які змушують студентів думати глибше і розглядати навчальний процес з різних боків.
Юрій Гуляницький став справжнім символом не тільки для своєї групи, а й для всього університету. Його невидима присутність завжди нагадує студентам, що навчання - це не просто набір знань, а подорож у світ загадок і див.""")
    elif subtopic == 'цікавий факт':
        facts = ["""Сонячні панелі на Міжнародній космічній станції (МКС) здатні згенерувати достатньо енергії для життя 8 сімейних будинків протягом року. 
Сонячні панелі МКС складаються з близько 262 400 фотоелементів, які використовують сонячне випромінювання для генерації електрики.""",
                 """У листопаді 2022 року було запущено перший в світі суперкомп'ютер з квантовими перевагами під назвою IBM Quantum Condor. 
Цей суперкомп'ютер має 65 кубітів і здатний виконувати обчислення, які перевищують можливості традиційних комп'ютерів. 
Він відкриває нові можливості для досліджень у галузі квантової фізики, хімії, машинного навчання та інших сфер."""]
        bot_response(random.choice(facts))
    elif subtopic == 'в чому сенс життя':
        bot_response("""в каві без цукру...мабуть""")
    elif subtopic == 'що варто зауважити при створенні власного чатботу':
        bot_response("""З власного досвіду можу сильно порекомендовати робити бекапи, особливо якщо до цього подібними задачами в великому обсязі займались мало, ну і, звісно не забути здати його якщо це навчальний проєкт...""")
    else:
        handle_formula_subtopics(subtopic) #перехід до формульних тем, якщо введений запит не був командою, є в загальному списку
                                           # підтем але потребує особливої обробки

#обробка формульних тем та вивід відповідей
def handle_formula_subtopics(formula_subtopic):
    while True:
        try:
            if formula_subtopic == 'закон збереження енергії':
                bot_response('Формула для обчислення потенціальної енергії: Epot = m * g * h')
                bot_response("Введіть масу тіла (у кілограмах): ")
                m = get_float()
                bot_response("Введіть значення прискорення вільного падіння g (у м/с^2): ")
                g = get_float()
                bot_response("Введіть висоту h (у метрах): ")
                h = get_float()

                potential_energy = m * g * h

                bot_response(f'Потенціальна енергія: {potential_energy} Дж')


            if formula_subtopic == 'закон кулона':
                bot_response(
                    'Закон Кулона - сила взаємодії між зарядами. Формула площі трикутника -> F = k * (|q1| * |q2|) / r^2')
                bot_response("Введіть заряд першої частинки q1 (в кулонах): ")
                q1 = get_float()
                bot_response("Введіть заряд другої частинки q2 (в кулонах): ")
                q2 = get_float()
                bot_response("Введіть відстань між зарядами r (в метрах): ")
                r = get_float()

                k = 8.99 * 10 ** 9  # електростатична константа
                force = k * abs(q1) * abs(q2) / r ** 2

                bot_response(f'Сила взаємодії за Законом Кулона: {force} Н')

            if formula_subtopic == 'закон стефана-больцмана':
                bot_response(
                    'Закон Стефана-Больцмана - закон, який описує випромінювану потужність чорного тіла. Формула: P = ε * σ * A * T^4')
                bot_response("Введіть емісійний коефіцієнт ε: ")
                epsilon = get_float()
                bot_response("Введіть площу поверхні тіла A (в квадратних метрах): ")
                a = get_float()
                bot_response("Введіть температуру тіла T (в кельвінах): ")
                t = get_float()

                sigma = 5.67 * 10 ** (-8)  # постійна Стефана-Больцмана
                power = epsilon * sigma * a * t ** 4

                bot_response(f'Випромінювана потужність чорного тіла: {power} Вт')

            if formula_subtopic == 'формула скалярного добутку векторів':
                bot_response(
                    'Скалярний добуток векторів - це сума добутків відповідних координат векторів. Формула: A · B = A₁ * B₁ + A₂ * B₂ + A₃ * B₃')
                bot_response("Введіть координати першого вектора A (у форматі x,y,z): ")
                a = []
                a.append(get_float())
                a.append(get_float())
                a.append(get_float())
                bot_response("Введіть координати другого вектора B (у форматі x,y,z): ")
                b = []
                b.append(get_float())
                b.append(get_float())
                b.append(get_float())

                dot_product = a[0] * b[0] + a[1] * b[1] + a[2] * b[2]

                bot_response(f'Скалярний добуток векторів A і B: {dot_product}')

            if formula_subtopic == 'формула для обчислення площі трикутника за допомогою векторного добутку':
                bot_response('Формула площі трикутника -> A = 0.5 * |v1 x v2|')
                bot_response("Введіть координати вектора v1 (у форматі x,y,z): ")
                v1 = []
                v1.append(get_float())
                v1.append(get_float())
                v1.append(get_float())
                bot_response("Введіть координати вектора v2 (у форматі x,y,z): ")
                v2 = []
                v2.append(get_float())
                v2.append(get_float())
                v2.append(get_float())

                cross_product = [
                    v1[1] * v2[2] - v1[2] * v2[1],
                    v1[2] * v2[0] - v1[0] * v2[2],
                    v1[0] * v2[1] - v1[1] * v2[0]
                ]
                area = 0.5 * math.sqrt(cross_product[0] ** 2 + cross_product[1] ** 2 + cross_product[2] ** 2)

                bot_response(f'Площа трикутника дорівнює: {area}')

            if formula_subtopic == 'формула для обчислення довжини відрізка між двома точками на площині':
                bot_response('Формула для обчислення довжини відрізка між двома точками на площині.')
                bot_response("Введіть координати першої точки (x1, y1): ")
                x1 = get_float()
                y1 = get_float()
                bot_response("Введіть координати другої точки (x2, y2): ")
                x2 = get_float()
                y2 = get_float()

                distance = math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2)

                bot_response(f'Довжина відрізка між точками ({x1}, {y1}) і ({x2}, {y2}): {distance}')

            if formula_subtopic == 'площа трикутника':
                bot_response('Формула площі трикутника -> S = 0.5 * b * h')
                bot_response("Введіть довжину основи трикутника b: ")
                b = get_float()
                bot_response("Введіть висоту трикутника, опущену на основу h: ")
                h = get_float()
                bot_response(f'Площа трикутника дорівнює: {0.5 * b * h}')
        except Stopping:
            break
    return None

#збереження переданних bot_response та user_input значень у формі діалога в файл названий за часом початку діалогу
def store_chat_log(request, response):
    file_name = f"dialog-{date_time}.txt"
    with open(file_name, 'a', encoding='utf-8') as file:
        if request:
            file.write(f'[Користувач]: {request}\n')
        if response:
            file.write(f'[Бот]: {response}\n')

#основний цикл, що оперує функціями
bot_response(greeting)
while True:                 #зациклення
    try:                                          #блок для захопленя виключення й перерву циклу, див. except нижче
        input_text = check_input_for_commands()
        current_topic = get_current_topic()
        subtopics = get_subtopics(current_topic)
        if input_text is not None:
            if input_text in subtopics:
                topic_history.append(input_text)
                if current_topic is not None:
                    response = get_info()
                    bot_response(response)
                    handle_subtopics(input_text)
                    topic_history.pop()             #вихід з підтем, адже вони відпацьовують лише один раз і не мають підтем
                    bot_response(get_info())    #уникнення додачі коментарю, адже користувач не обирав цю тему в ручну
                    continue                   #уникнення додачі коментарю, адже користувач не обирав цю тему в ручну
            else:
                bot_response(f'Я не знаю цієї теми. Оберіть, будь ласка, з доступних: {", ".join(subtopics)}.')
                continue                             #перезапит вводу якщо він не був ані командою, ані темою/підтемою
            if random.random() < 0.25:
                resp = random_comment() + get_info()      #додача коментаря до тіла відповіді з деякою вірогідністю
                bot_response(resp)
            else:
                bot_response(get_info())
    except Exiting:                                                                #вихід з коду в будь-якій частині
        bot_response("Вихід з програми. Було приємно поспілкуватись, бувайте!")     #якщо була введена команда
        break
    except BackRequested:                                          #повернення до минулої теми в будь-якій частині коду
        if len(topic_history) > 0:                                  #якщо була введена команда
            topic_history.pop()
            bot_response(get_info())
        else:
            bot_response(greeting)
